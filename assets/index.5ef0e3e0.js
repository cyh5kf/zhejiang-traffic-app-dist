import{c as Y,n as M,t as le,u as H,e as j,i as C,I as E,w as Z,g as ye,s as ke,a as xe,b as Ce,d as we,m as A,f as Se,h as Be,F as Ve,j as Me,C as Ae,k as Ie,l as Q,o as Pe,p as R,r as Te,q as X}from"./index.b865c194.js";import{r as qe,u as ze,a as re}from"./use-id.a36b7f41.js";import{d as _,e as o,s as $e,q as W,g as z,D as Ee,B as Le,x as F,v as De,H as ne,k as Fe}from"./index.4447ae21.js";import{u as ie}from"./use-expose.90c22438.js";const[He,V]=Y("cell"),oe={icon:String,size:String,title:M,value:M,label:M,center:Boolean,isLink:Boolean,border:le,required:Boolean,iconPrefix:String,valueClass:H,labelClass:H,titleClass:H,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},We=Z(_({name:He,props:j({},oe,qe),setup(e,{slots:t}){const i=ze(),y=()=>{if(t.label||C(e.label))return o("div",{class:[V("label"),e.labelClass]},[t.label?t.label():e.label])},c=()=>{if(t.title||C(e.title))return o("div",{class:[V("title"),e.titleClass],style:e.titleStyle},[t.title?t.title():o("span",null,[e.title]),y()])},p=()=>{const f=t.value||t.default;if(f||C(e.value)){const d=t.title||C(e.title);return o("div",{class:[V("value",{alone:!d}),e.valueClass]},[f?f():o("span",null,[e.value])])}},w=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const f=e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return o(E,{name:f,class:V("right-icon")},null)}};return()=>{var f,d;const{size:v,center:g,border:I,isLink:S,required:P}=e,h=(f=e.clickable)!=null?f:S,k={center:g,required:P,clickable:h,borderless:!I};return v&&(k[v]=!!v),o("div",{class:V(k),role:h?"button":void 0,tabindex:h?0:void 0,onClick:i},[t.icon?t.icon():e.icon?o(E,{name:e.icon,class:V("left-icon"),classPrefix:e.iconPrefix},null):void 0,c(),p(),w(),(d=t.extra)==null?void 0:d.call(t)])}}}));function ee(e){return Array.isArray(e)?!e.length:e!==0&&!e}function ae(e,t){const{message:i}=t;return Ce(i)?i(e,t):i||""}function je({target:e}){e.composing=!0}function te({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function K(e){return[...e].length}const[Oe,b]=Y("field"),U={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:M,formatter:Function,clearIcon:A("clear"),modelValue:Se(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:A("focus"),formatTrigger:A("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},Ke=Z(_({name:Oe,props:j({},oe,U,{rows:M,type:A("text"),rules:Array,autosize:[Boolean,Object],labelWidth:M,labelClass:H,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","click-input","end-validate","start-validate","click-left-icon","click-right-icon","update:modelValue"],setup(e,{emit:t,slots:i}){const y=re(),c=$e({status:"unvalidated",focused:!1,validateMessage:""}),p=W(),w=W(),f=W(),{parent:d}=Be(Ve),v=()=>{var a;return String((a=e.modelValue)!=null?a:"")},g=a=>C(e[a])?e[a]:d&&C(d.props[a])?d.props[a]:void 0,I=z(()=>{const a=g("readonly");if(e.clearable&&!a){const s=v()!=="",l=e.clearTrigger==="always"||e.clearTrigger==="focus"&&c.focused;return s&&l}return!1}),S=z(()=>f.value&&i.input?f.value():e.modelValue),P=a=>a.reduce((s,l)=>s.then(()=>{if(c.status==="failed")return;let{value:u}=S;if(l.formatter&&(u=l.formatter(u,l)),!function(r,m){if(ee(r)){if(m.required)return!1;if(m.validateEmpty===!1)return!0}return!(m.pattern&&!m.pattern.test(String(r)))}(u,l))return c.status="failed",void(c.validateMessage=ae(u,l));if(l.validator)return ee(u)&&l.validateEmpty===!1?void 0:function(r,m){return new Promise(x=>{const O=m.validator(r,m);xe(O)?O.then(x):x(O)})}(u,l).then(r=>{r&&typeof r=="string"?(c.status="failed",c.validateMessage=r):r===!1&&(c.status="failed",c.validateMessage=ae(u,l))})}),Promise.resolve()),h=()=>{c.status="unvalidated",c.validateMessage=""},k=()=>t("end-validate",{status:c.status}),L=(a=e.rules)=>new Promise(s=>{h(),a?(t("start-validate"),P(a).then(()=>{c.status==="failed"?(s({name:e.name,message:c.validateMessage}),k()):(c.status="passed",s(),k())})):s()}),T=a=>{if(d&&e.rules){const{validateTrigger:s}=d.props,l=Q(s).includes(a),u=e.rules.filter(r=>r.trigger?Q(r.trigger).includes(a):l);u.length&&L(u)}},B=(a,s="onChange")=>{if(a=(l=>{const{maxlength:u}=e;if(C(u)&&K(l)>u){const r=v();return r&&K(r)===+u?r:function(m,x){return[...m].slice(0,x).join("")}(l,+u)}return l})(a),e.type==="number"||e.type==="digit"){const l=e.type==="number";a=Pe(a,l,l)}e.formatter&&s===e.formatTrigger&&(a=e.formatter(a)),p.value&&p.value.value!==a&&(p.value.value=a),a!==e.modelValue&&t("update:modelValue",a)},n=a=>{a.target.composing||B(a.target.value)},q=()=>{var a;return(a=p.value)==null?void 0:a.blur()},D=()=>{const a=p.value;e.type==="textarea"&&e.autosize&&a&&function(s,l){const u=ye();s.style.height="auto";let r=s.scrollHeight;if(we(l)){const{maxHeight:m,minHeight:x}=l;m!==void 0&&(r=Math.min(r,m)),x!==void 0&&(r=Math.max(r,x))}r&&(s.style.height=`${r}px`,ke(u))}(a,e.autosize)},se=a=>{c.focused=!0,t("focus",a),F(D),g("readonly")&&q()},ce=a=>{g("readonly")||(c.focused=!1,B(v(),"onBlur"),t("blur",a),T("onBlur"),F(D),Te())},G=a=>t("click-input",a),ue=a=>t("click-left-icon",a),de=a=>t("click-right-icon",a),J=z(()=>typeof e.error=="boolean"?e.error:!(!d||!d.props.showError||c.status!=="failed")||void 0),ge=z(()=>{const a=g("labelWidth");if(a)return{width:Me(a)}}),fe=a=>{a.keyCode===13&&(d&&d.props.submitOnEnter||e.type==="textarea"||R(a),e.type==="search"&&q()),t("keypress",a)},N=()=>e.id||`${y}-input`,pe=()=>{const a=b("control",[g("inputAlign"),{error:J.value,custom:!!i.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(i.input)return o("div",{class:a,onClick:G},[i.input()]);const s={id:N(),ref:p,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:a,disabled:g("disabled"),readonly:g("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${y}-label`:void 0,onBlur:ce,onFocus:se,onInput:n,onClick:G,onChange:te,onKeypress:fe,onCompositionend:te,onCompositionstart:je};return e.type==="textarea"?o("textarea",s,null):o("input",ne((l=e.type)==="number"?{type:"text",inputmode:"decimal"}:l==="digit"?{type:"tel",inputmode:"numeric"}:{type:l},s),null);var l},ve=()=>{const a=i["right-icon"];if(e.rightIcon||a)return o("div",{class:b("right-icon"),onClick:de},[a?a():o(E,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},me=()=>{if(e.showWordLimit&&e.maxlength){const a=K(v());return o("div",{class:b("word-limit")},[o("span",{class:b("word-num")},[a]),Fe("/"),e.maxlength])}},be=()=>{if(d&&d.props.showErrorMessage===!1)return;const a=e.errorMessage||c.validateMessage;if(a){const s=i["error-message"],l=g("errorMessageAlign");return o("div",{class:b("error-message",l)},[s?s({message:a}):a])}},he=()=>[o("div",{class:b("body")},[pe(),I.value&&o(E,{ref:w,name:e.clearIcon,class:b("clear")},null),ve(),i.button&&o("div",{class:b("button")},[i.button()])]),me(),be()];return ie({blur:q,focus:()=>{var a;return(a=p.value)==null?void 0:a.focus()},validate:L,formValue:S,resetValidation:h,getValidationStatus:()=>c.status}),Ee(Ae,{customValue:f,resetValidation:h,validateWithTrigger:T}),Le(()=>e.modelValue,()=>{B(v()),h(),T("onChange"),F(D)}),De(()=>{B(v(),e.formatTrigger),F(D)}),Ie("touchstart",a=>{R(a),t("update:modelValue",""),t("clear",a)},{target:z(()=>{var a;return(a=w.value)==null?void 0:a.$el})}),()=>{const a=g("disabled"),s=g("labelAlign"),l=(()=>{const r=g("colon")?":":"";return i.label?[i.label(),r]:e.label?o("label",{id:`${y}-label`,for:N()},[e.label+r]):void 0})(),u=(()=>{const r=i["left-icon"];if(e.leftIcon||r)return o("div",{class:b("left-icon"),onClick:ue},[r?r():o(E,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return o(We,{size:e.size,icon:e.leftIcon,class:b({error:J.value,disabled:a,[`label-${s}`]:s}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:ge.value,valueClass:b("value"),titleClass:[b("label",[s,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:u?()=>u:null,title:l?()=>l:null,value:he,extra:i.extra})}}})),[Re,$,Ue]=Y("search"),Je=Z(_({name:Re,props:j({},U,{label:String,shape:A("square"),leftIcon:A("search"),clearable:le,actionText:String,background:String,showAction:Boolean}),emits:["blur","focus","clear","search","cancel","click-input","click-left-icon","click-right-icon","update:modelValue"],setup(e,{emit:t,slots:i,attrs:y}){const c=re(),p=W(),w=()=>{i.action||(t("update:modelValue",""),t("cancel"))},f=n=>{n.keyCode===13&&(R(n),t("search",e.modelValue))},d=()=>e.id||`${c}-input`,v=()=>{if(i.label||e.label)return o("label",{class:$("label"),for:d()},[i.label?i.label():e.label])},g=()=>{if(e.showAction){const n=e.actionText||Ue("cancel");return o("div",{class:$("action"),role:"button",tabindex:0,onClick:w},[i.action?i.action():n])}},I=n=>t("blur",n),S=n=>t("focus",n),P=n=>t("clear",n),h=n=>t("click-input",n),k=n=>t("click-left-icon",n),L=n=>t("click-right-icon",n),T=Object.keys(U),B=()=>{const n=j({},y,X(e,T),{id:d()});return o(Ke,ne({ref:p,type:"search",class:$("field"),border:!1,onBlur:I,onFocus:S,onClear:P,onKeypress:f,"onClick-input":h,"onClick-left-icon":k,"onClick-right-icon":L,"onUpdate:modelValue":q=>t("update:modelValue",q)},n),X(i,["left-icon","right-icon"]))};return ie({focus:()=>{var n;return(n=p.value)==null?void 0:n.focus()},blur:()=>{var n;return(n=p.value)==null?void 0:n.blur()}}),()=>{var n;return o("div",{class:$({"show-action":e.showAction}),style:{background:e.background}},[(n=i.left)==null?void 0:n.call(i),o("div",{class:$("content",e.shape)},[v(),B()]),g()])}}}));export{Je as S};
